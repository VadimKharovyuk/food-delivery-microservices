<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç Backend - –°–æ–∑–¥–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .header p {
      opacity: 0.9;
      font-size: 1.1rem;
    }

    .form-container {
      padding: 40px;
    }

    .form-group {
      margin-bottom: 25px;
    }

    .form-row {
      display: flex;
      gap: 20px;
    }

    .form-row .form-group {
      flex: 1;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 0.95rem;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }

    input:focus,
    textarea:focus {
      outline: none;
      border-color: #ff6b6b;
      background: white;
      box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .image-upload {
      border: 2px dashed #ff6b6b;
      border-radius: 10px;
      padding: 30px;
      text-align: center;
      background: #fff8f8;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .image-upload:hover {
      border-color: #ee5a24;
      background: #fff0f0;
    }

    .image-upload.dragover {
      border-color: #ee5a24;
      background: #ffe6e6;
      transform: scale(1.02);
    }

    .upload-icon {
      font-size: 3rem;
      color: #ff6b6b;
      margin-bottom: 15px;
    }

    .upload-text {
      color: #666;
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    .upload-hint {
      color: #999;
      font-size: 0.9rem;
    }

    #imageFile {
      display: none;
    }

    .image-preview {
      margin-top: 20px;
      text-align: center;
    }

    .preview-image {
      max-width: 200px;
      max-height: 200px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 10px;
    }

    .remove-image {
      background: #ff4757;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s ease;
    }

    .remove-image:hover {
      background: #ff3742;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
      transform: scale(1.2);
    }

    .submit-btn {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      color: white;
      border: none;
      padding: 16px 40px;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 20px;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #666;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #ff6b6b;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 10px;
      display: none;
    }

    .alert.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .test-info {
      background: #ffe6e6;
      color: #cc0000;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border: 1px solid #ffcccc;
    }

    .endpoint-info {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border-left: 4px solid #ff6b6b;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: 0;
      }

      .container {
        margin: 10px;
        border-radius: 15px;
      }

      .form-container {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üöÄ Backend –¢–µ—Å—Ç</h1>
    <p>–ü—Ä—è–º–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞</p>
  </div>

  <div class="form-container">
    <div class="test-info">
      <strong>üß™ Backend Test Mode:</strong> –≠—Ç–∞ —Ñ–æ—Ä–º–∞ –Ω–∞–ø—Ä—è–º—É—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ backend —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
    </div>

    <div class="endpoint-info">
      <strong>Endpoint:</strong> POST /api/stores<br>
      <strong>Content-Type:</strong> multipart/form-data<br>
      <strong>Parts:</strong><br>
      - store: JSON (CreateStoreDto)<br>
      - imageFile: MultipartFile<br>
      <strong>Headers:</strong> X-User-Id: Long
    </div>

    <div id="alert" class="alert"></div>

    <form id="storeForm">
      <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <div class="form-group">
        <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ *</label>
        <input type="text" id="name" name="name" required maxlength="100" value="Backend Test Store">
      </div>

      <div class="form-group">
        <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea id="description" name="description" maxlength="500" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω...">–¢–µ—Å—Ç–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ backend</textarea>
      </div>

      <!-- –ê–¥—Ä–µ—Å -->
      <h3 style="margin: 30px 0 20px 0; color: #333;">üìç –ê–¥—Ä–µ—Å</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="street">–£–ª–∏—Ü–∞ *</label>
          <input type="text" id="street" name="street" required maxlength="200" value="Backend Street 1">
        </div>
        <div class="form-group">
          <label for="city">–ì–æ—Ä–æ–¥ *</label>
          <input type="text" id="city" name="city" required maxlength="100" value="Backend City">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="region">–†–µ–≥–∏–æ–Ω</label>
          <input type="text" id="region" name="region" maxlength="100" value="Backend Region">
        </div>
        <div class="form-group">
          <label for="postalCode">–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å</label>
          <input type="text" id="postalCode" name="postalCode" pattern="[0-9]{5,10}" value="12345">
        </div>
      </div>

      <div class="form-group">
        <label for="country">–°—Ç—Ä–∞–Ω–∞ *</label>
        <input type="text" id="country" name="country" required maxlength="100" value="Test Country">
      </div>

      <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
      <h3 style="margin: 30px 0 20px 0; color: #333;">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
          <input type="tel" id="phone" name="phone" pattern="[+]?[0-9\s\-\(\)]{10,20}" value="+1 (555) 123-4567">
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" maxlength="100" value="backend@test.com">
        </div>
      </div>

      <!-- –î–æ—Å—Ç–∞–≤–∫–∞ -->
      <h3 style="margin: 30px 0 20px 0; color: #333;">üöö –î–æ—Å—Ç–∞–≤–∫–∞</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="deliveryRadius">–†–∞–¥–∏—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏ (–∫–º) *</label>
          <input type="number" id="deliveryRadius" name="deliveryRadius" required min="1" max="50" value="10">
        </div>
        <div class="form-group">
          <label for="deliveryFee">–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (‚ÇΩ) *</label>
          <input type="number" id="deliveryFee" name="deliveryFee" required min="0" max="99999.99" step="0.01" value="150">
        </div>
      </div>

      <div class="form-group">
        <label for="estimatedDeliveryTime">–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ (–º–∏–Ω—É—Ç—ã) *</label>
        <input type="number" id="estimatedDeliveryTime" name="estimatedDeliveryTime" required min="10" max="180" value="30">
      </div>

      <!-- User ID –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
      <div class="form-group">
        <label for="userId">User ID (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) *</label>
        <input type="number" id="userId" name="userId" required min="1" value="999" style="border: 2px solid #ff6b6b;">
      </div>

      <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
      <h3 style="margin: 30px 0 20px 0; color: #333;">üì∏ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ *</h3>

      <div class="form-group">
        <div class="image-upload" id="imageUpload">
          <div class="upload-icon">üì∑</div>
          <div class="upload-text">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</div>
          <div class="upload-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, WEBP (–º–∞–∫—Å. 10MB)</div>
          <input type="file" id="imageFile" name="imageFile" accept="image/*" required>
        </div>
        <div id="imagePreview" class="image-preview"></div>
      </div>

      <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
      <div class="form-group">
        <div class="checkbox-group">
          <input type="checkbox" id="isActive" name="isActive" checked>
          <label for="isActive">–ú–∞–≥–∞–∑–∏–Ω –∞–∫—Ç–∏–≤–µ–Ω</label>
        </div>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ Backend
      </button>
    </form>

    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p>–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ backend —Å–µ—Ä–≤–µ—Ä...</p>
    </div>
  </div>
</div>

<script>
  // –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
  const form = document.getElementById('storeForm');
  const imageUpload = document.getElementById('imageUpload');
  const imageFile = document.getElementById('imageFile');
  const imagePreview = document.getElementById('imagePreview');
  const submitBtn = document.getElementById('submitBtn');
  const loading = document.getElementById('loading');
  const alert = document.getElementById('alert');

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  imageUpload.addEventListener('click', () => {
    imageFile.click();
  });

  imageUpload.addEventListener('dragover', (e) => {
    e.preventDefault();
    imageUpload.classList.add('dragover');
  });

  imageUpload.addEventListener('dragleave', () => {
    imageUpload.classList.remove('dragover');
  });

  imageUpload.addEventListener('drop', (e) => {
    e.preventDefault();
    imageUpload.classList.remove('dragover');

    const files = e.dataTransfer.files;
    if (files.length > 0) {
      handleImageFile(files[0]);
    }
  });

  imageFile.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
      handleImageFile(e.target.files[0]);
    }
  });

  function handleImageFile(file) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
    if (!file.type.startsWith('image/')) {
      showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (10MB)
    if (file.size > 10 * 1024 * 1024) {
      showAlert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 10MB', 'error');
      return;
    }

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∞–π–ª –≤ input
    const dataTransfer = new DataTransfer();
    dataTransfer.items.add(file);
    imageFile.files = dataTransfer.files;

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é
    const reader = new FileReader();
    reader.onload = (e) => {
      imagePreview.innerHTML = `
                    <img src="${e.target.result}" alt="Preview" class="preview-image">
                    <br>
                    <button type="button" class="remove-image" onclick="removeImage()">–£–¥–∞–ª–∏—Ç—å</button>
                `;
    };
    reader.readAsDataURL(file);
  }

  function removeImage() {
    imageFile.value = '';
    imagePreview.innerHTML = '';
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–±—Ä–∞–Ω —Ñ–∞–π–ª
    const imageFileInput = document.getElementById('imageFile');
    if (!imageFileInput.files || imageFileInput.files.length === 0) {
      showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!', 'error');
      return;
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
    submitBtn.disabled = true;
    loading.style.display = 'block';
    form.style.display = 'none';

    try {
      // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Ä—Ç backend —Å–µ—Ä–≤–µ—Ä–∞ (–æ–±—ã—á–Ω–æ 8083 –¥–ª—è product-service)
      const backendPort = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–æ—Ä—Ç backend —Å–µ—Ä–≤–µ—Ä–∞ (–æ–±—ã—á–Ω–æ 8083):', '8083');
      if (!backendPort) {
        throw new Error('–ü–æ—Ä—Ç –Ω–µ —É–∫–∞–∑–∞–Ω');
      }

      // –°–æ–∑–¥–∞–Ω–∏–µ FormData –¥–ª—è backend (—Ç–æ—á–Ω–æ –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä)
      const formData = new FormData();

      // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç CreateStoreDto
      const storeDto = {
        name: document.getElementById('name').value || '',
        description: document.getElementById('description').value || '',
        street: document.getElementById('street').value || '',
        city: document.getElementById('city').value || '',
        region: document.getElementById('region').value || '',
        postalCode: document.getElementById('postalCode').value || '',
        country: document.getElementById('country').value || '',
        phone: document.getElementById('phone').value || '',
        email: document.getElementById('email').value || '',
        deliveryRadius: parseInt(document.getElementById('deliveryRadius').value) || 0,
        deliveryFee: parseFloat(document.getElementById('deliveryFee').value) || 0,
        estimatedDeliveryTime: parseInt(document.getElementById('estimatedDeliveryTime').value) || 0,
        isActive: document.getElementById('isActive').checked
      };

      // –î–æ–±–∞–≤–ª—è–µ–º store –∫–∞–∫ JSON blob
      formData.append('store', new Blob([JSON.stringify(storeDto)], {
        type: 'application/json'
      }));

      // –î–æ–±–∞–≤–ª—è–µ–º imageFile
      formData.append('imageFile', imageFileInput.files[0]);

      const userId = document.getElementById('userId').value;

      console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ backend:');
      console.log('- URL: http://localhost:' + backendPort + '/api/stores');
      console.log('- store:', storeDto);
      console.log('- imageFile:', imageFileInput.files[0].name, imageFileInput.files[0].size, 'bytes');
      console.log('- X-User-Id:', userId);

      // –û—Ç–ø—Ä–∞–≤–∫–∞ –ù–ê–ü–†–Ø–ú–£–Æ –Ω–∞ backend —Å–µ—Ä–≤–µ—Ä
      const response = await fetch(`http://localhost:${backendPort}/api/stores`, {
        method: 'POST',
        headers: {
          'X-User-Id': userId
          // –ù–ï –î–û–ë–ê–í–õ–Ø–ï–ú Content-Type - –±—Ä–∞—É–∑–µ—Ä —Å–∞–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å boundary
        },
        body: formData
      });

      console.log('üì° Response status:', response.status);
      console.log('üì° Response headers:', [...response.headers.entries()]);

      let result;
      const contentType = response.headers.get('content-type');

      if (contentType && contentType.includes('application/json')) {
        result = await response.json();
      } else {
        const textResult = await response.text();
        console.error('Non-JSON response:', textResult);
        result = { success: false, message: '–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª: ' + textResult.substring(0, 100) };
      }

      if (response.ok && result.success) {
        showAlert('üéâ SUCCESS! –ú–∞–≥–∞–∑–∏–Ω —Å–æ–∑–¥–∞–Ω –Ω–∞ backend —Å–µ—Ä–≤–µ—Ä–µ!', 'success');
        console.log('‚úÖ Success response:', result);
      } else {
        showAlert(`‚ùå Backend –æ—à–∏–±–∫–∞: ${result.message || 'Unknown error'} (${response.status})`, 'error');
        console.error('‚ùå Error response:', result);
      }

    } catch (error) {
      console.error('üí• Error:', error);
      if (error.message.includes('Failed to fetch')) {
        showAlert('üîå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ backend —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–æ—Ä—Ç—É.', 'error');
      } else {
        showAlert('üí• –û—à–∏–±–∫–∞: ' + error.message, 'error');
      }
    } finally {
      // –°–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
      submitBtn.disabled = false;
      loading.style.display = 'none';
      form.style.display = 'block';
    }
  });

  function showAlert(message, type) {
    alert.textContent = message;
    alert.className = `alert ${type}`;
    alert.style.display = 'block';

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è —É—Å–ø–µ—Ö–∞, 15 –¥–ª—è –æ—à–∏–±–∫–∏
    setTimeout(() => {
      alert.style.display = 'none';
    }, type === 'success' ? 10000 : 15000);
  }

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –∞–ª–µ—Ä—Ç–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ
  alert.addEventListener('click', () => {
    alert.style.display = 'none';
  });
</script>
</body>
</html>